<div class="post">
  <h1>
    <%=h @post.title %>
  </h1>
	<div class='post-header'>
		<span class="post-date">
      <%= human_date @post.published_on %><br/>
      <a href="#comments"><%= @post.comments.size %>&nbsp;comments</a>
			<a href="http://<%= hostname %>/<%= @post.id %>/feed" class="image">&nbsp;<img src='/images/rss.gif'/></a>
    </span>
  </div>
  
  <div class="body">
	    <%= @post.full_body_html %>
  </div><!-- /body -->
  
  <div id="comments">
    
    <h3>Comments <a href="http://<%= hostname %>/<%= @post.id %>/feed" class="image">&nbsp;<img src='/images/rss.gif'/></a></h3>
		
    
    <% @post.comments.each_with_index do |comment, index| %>
    <% if params[:thank_you] && comment == @post.comments.last %>
    <div id="comment_added_thanks"><div class="in"><p>Thank you for your comment!</p></div></div>
    <% end %>
    <div class="comment<%= ' spam' if comment.spam? %>" id="comment_<%= comment.id %>">
      <div class="number"><span class="nodisplay"></span><%= index.succ %></div>
      <div class="message">
        <%= markup h(comment.body) %>
      </div>
      <div class="author">
				<a href="http://gravatar.com" class='image'><img src="<%= comment.gravatar_url(:size => 40) %>" class='gravatar'/></a>
        <strong>
        <%= comment.url ? "<a href=\"#{h(comment.url)}\">#{h(comment.author)}</a>" : h(comment.author) %>
        </strong> wrote on <%= human_date(comment.created_at) %></div>

    </div><!-- /comment -->

    <% end %>

    <div id="comment_form">
      <h3 id="add_comment">Add Comment</h3>

      <form action="/<%= @post.id %>/comments#add_comment" method="post" accept-charset="utf-8">

        <label class="required">Your name:</label>
        <input type="text" class="text" name="author" value="<%=@comment.try(:author)%>" id="author" />
        <span>(required)</span>
        <% if  @comment and @comment.errors and @comment.errors.on(:author) %><div class="error">Author <%= @comment.errors.on(:author) %></div><% end %>
        <br />
        <label class="required">Your e-mail:</label>
        <input type="text" class="text" name="email" value="<%=@comment.try(:email)%>" id="email" />
        <span>(required, won't be displayed)</span>
        <% if  @comment and @comment.errors and @comment.errors.on(:email) %>
				<br/>
				<div class="error">E-Mail <%= @comment.errors.on(:email) %></div>
				<% end %>
        <br />

        <label>Your website:</label>
        <input type="text" class="text" name="url" value="" id="url" />
        <br />

        <label>Message:</label>
        <textarea name="body" rows="8" cols="40"></textarea>
        <% if @comment and @comment.errors and @comment.errors.on(:body)%>
				<br/>
				<div class="error">Message <%= @comment.errors.on(:body) if @comment %></div>
				<% end %>
        <span style="margin-left: 13.5em">(Use Markdown syntax)</span>
        <br />

        <input class="submit" type="submit" value="Post Comment &raquo;" accesskey="s" />
      </form>
    <div class="clear">&nbsp;</div>
    </div><!-- /comment_form -->

  </div><!-- /comments -->
</div>
