<div class="post">
  <h1>
    <%=h @post.title %>
  </h1>
	<div class='post-header'>
		<span class="post-date">
      <%= human_date @post.published_on %><br/>
      <a href="#comments"><%= @post.comments.size %>&nbsp;comments</a>
			<a href="http://<%= hostname %>/<%= @post.id %>/feed" class="image">&nbsp;<img src='/images/rss.gif'/></a>
    </span>
  </div>
  
  <div class="body">
	    <%= @post.full_body_html %>
  </div><!-- /body -->

	<div class='related'>
		
		<h3><img src='/images/flourish-l.gif'/>More from Rails Illustrated</h3>
		<div class='bottom-subscribe'>		
			<a href='http://feeds.feedburner.com/railsillustrated/HCTH' class='image'><img src='/images/rss_large.gif' class='rss' style="width: 15px; height: 15px;"/></a><a href='http://feeds.feedburner.com/railsillustrated/HCTH'>subscribe to the RSS feed</a>
		</div>
		<ul>
		<% @post.related.each do |post| %>
			<li><a href="/<%= post.id %>.html"><%= Marley::Post.find_one(post.id, :only => ['title']).title %></a>
			</li>
		<% end %>
		</ul>
	</div>

  <div id="comments">
		<!-- AddThis Button BEGIN -->
		<div><script type="text/javascript">var addthis_pub="eandrejko";</script>
		<a class="plain" href="http://www.addthis.com/bookmark.php" onmouseover="return addthis_open(this, '', '[URL]', '[TITLE]')" onmouseout="addthis_close()" onclick="return addthis_sendto()"><img src="http://s7.addthis.com/static/btn/lg-share-en.gif" width="125" height="16" border="0" alt="" style="border:0"/></a><script type="text/javascript" src="http://s7.addthis.com/js/152/addthis_widget.js"></script></div>
		<!-- AddThis Button END -->
		
    
    <h3>Comments <a href="http://<%= hostname %>/<%= @post.id %>/feed" class="image">&nbsp;<img src='/images/rss.gif'/></a></h3>
		

    <% @post.comments.each_with_index do |comment, index| %>
    <% if params[:thank_you] && comment == @post.comments.last %>
    <div id="comment_added_thanks"><div class="in"><p>Thank you for your comment!</p></div></div>
    <% end %>
    <div class="comment<%= ' spam' if comment.spam? %>" id="comment_<%= comment.id %>">
      <div class="number"><span class="nodisplay"></span><%= index.succ %></div>
      <div class="message">
        <%= markup h(comment.body) %>
      </div>
      <div class="author">
				<a href="http://gravatar.com" class='image'><img src="<%= comment.gravatar_url(:size => 40) %>" class='gravatar'/></a>
        <strong>
        <%= comment.url ? "<a href=\"#{h(comment.url)}\">#{h(comment.author)}</a>" : h(comment.author) %>
        </strong> wrote on <%= human_date(comment.created_at) %></div>

    </div><!-- /comment -->

    <% end %>

    <div id="comment_form">
      <h3 id="add_comment">Add Comment</h3>

      <form action="/<%= @post.id %>/comments#add_comment" method="post" accept-charset="utf-8">

        <label class="required">Your name:</label>
        <input type="text" class="text" name="author" value="<%=@comment.try(:author)%>" id="author" />
        <span class='hint'>(required)</span>
        <% if  @comment and @comment.errors and @comment.errors.on(:author) %><div class="error">Author <%= @comment.errors.on(:author) %></div><% end %>
        <br />
        <label class="required">Your e-mail:</label>
        <input type="text" class="text" name="email" value="<%=@comment.try(:email)%>" id="email" />
        <span class='hint'>(required, won't be displayed)</span>
        <% if  @comment and @comment.errors and @comment.errors.on(:email) %>
				<br/>
				<div class="error">E-Mail <%= @comment.errors.on(:email) %></div>
				<% end %>
        <br />

        <label>Your website:</label>
        <input type="text" class="text" name="url" value="" id="url" />
        <br />

        <label>Message:</label>
        <textarea name="body" rows="8" cols="40"></textarea>
        <% if @comment and @comment.errors and @comment.errors.on(:body)%>
				<br/>
				<div class="error">Message <%= @comment.errors.on(:body) if @comment %></div>
				<% end %>
        <span  class='hint' style="margin-left: 13.5em">(Use <a href="http://daringfireball.net/projects/markdown/syntax">Markdown syntax</a>)</span>
        <br />

				<div class='preview' style='display:none;'>
					<h3>Comment Preview <img src='/images/spinner.gif' id="preview-loading" style='display: none;'/></h3>
			    <div class="comment">
			      <div class="number"><span class="nodisplay"></span><%= @post.comments.length + 1 %></div>
			      <div class="message">
			      </div>
			      <div class="author">
							<a href="http://gravatar.com" class='image'><img src="http://gravatar.com/avatar/xxx?s=40" class='gravatar'/></a>
			        <strong>
			        </strong> wrote on <span class='comment-date'></span></div>

			    </div><!-- /comment -->
				</div>


        <input class="submit" type="submit" value="Post Comment &raquo;" accesskey="s" />
      </form>
    <div class="clear">&nbsp;</div>
    </div><!-- /comment_form -->

  </div><!-- /comments -->
</div>
